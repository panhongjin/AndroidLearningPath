# 操作系统引论

## 1.1 操作系统的目标和作用

### 1.1.1 操作系统的目标

&emsp;&emsp;目前存在着多种类型的OS，不同类型的OS，其目标各有所侧重。通常在计算机硬件上配置的OS，其目标有以下几点：
- 方便性
- 有效性
- 可扩充性
- 开放性


### 1.1.2 操作系统的作用

1. 从计算机系统组成观点----操作系统是系统软件
计算机系统组成：
- 软件：应用软件、系统软件(操作系统、语言处理系统和常用的例行服务程序)
- 硬件：输入/输出(I/O)设备、存储器(内存)、中央处理器(CPU)
2. 从资源管理程序观点----操作系统是系统资源管理者
- 操作系统是系统资源管理程序，用于控制和管理计算机系统的硬件和软件资源。
- 计算机系统资源：硬件:I/O设备、存储器、处理器；操作系统模块：文件系统、设备管理、存储器管理、处理器(进程)管理。<br>
&emsp;&emsp;在一个计算机系统中，通常都含有各种各样的硬件和软件资源。归纳起来可将资源分为四类：处理器、存储器、I/O设备以及信息(数据和程序)。相应地，OS的主要功能也正是针对这四类资源进行有效的管理，即：处理机管理，用于分配和控制处理机；存储器管理，主要负责内存的分配和回收；I/O设备管理，负责I/O设备的分配与操纵；文件管理，负责文件的存取、共享和保护。可见，OS确实是计算机系统资源的管理者。事实上，当今世界上广为流行的一个关于OS作用的观点，正是把OS作为计算机系统的资源管理者。
3. 从软件分层、扩充机器的观点----操作系统是扩充裸机的第一层系统软件<br>
软件：语言处理程序 -----> 虚拟机2<br>
软件：操作系统 ----> 虚拟机1<br>
硬件(裸机)<br>
虚拟机：二者结合变成了功能更强大使用更方便的机器。<br>
操作系统是扩展的机器，是虚拟机。
4. 从服务用户的观点----操作系统是用户与裸机之间的接口。
![Image text](https://github.com/panhongjin/AndroidLearningPath/raw/master/src/OperatingSystems/assets/OS_interface.JPG)
- 命令方式。指由OS提供了一组联机命令(语言)，用户可通过键盘输入有关命令，来直接操纵计算机系统。
- 系统调用方式。OS提供了一组系统调用，用户可在自己的应用程序中通过相应的系统调用，来操纵计算机。
- 图形、窗口方式。用户通过屏幕上的窗口和图标来操纵计算机系统和运行自己的程序。


### 1.1.3 推动操作系统发展的主要动力

1. 不断提高计算机资源利用率
2. 方便用户
3. 器件的不断更新换代
4. 计算机体系结构的不断发展


## 1.2 操作系统的发展过程

### 1.2.1 无操作系统的计算机系统

1. 人工操作方式<br>
&emsp;&emsp;从第一台计算机诞生(1945年)到50年代中期的计算机，属于第一代，这时还未出现OS。这时的计算机操作是由用户(即程序员)采用人工操作方式直接使用计算机硬件系统，即由程序员将事先已穿孔(对应于程序和数据)的纸带(或卡片)装入纸带输入机(或卡片输入机)，再启动它们将程序和数据输入计算机， 然后启动计算机运行。当程序运行完毕并取走计算结果后， 才让下一个用户上机。这种人工操作方式有以下两方面的缺点：
- 用户独占全机
- CPU等待人工操作
2. 脱机输入/输出(Off-Line I/O)方式<br>
这种脱机I/O方式的主要优点如下：
- 减小了CPU的空闲时间
- 提供了I/O速度

### 1.2.2 单道批处理系统

1. 批处理技术：它利用磁带容量较大的特点，先将一批作业按序以脱机方式输入到磁带上。主机在监督程序控制下，根据卡片机读入控制作业操作信息，逐个从磁带上读入作业到内存，调入汇编/编释程序将源程序翻译成目标代码，连接装配后执行，结果输出打印。执行完毕后再调入下一个作业，系统就这样自动地一个一个作业地进行处理，直至完成，这是早期单道批处理系统，它解决了作业自动转换，从而减少了作业建立和人工操作时间。
![Image text](https://github.com/panhongjin/AndroidLearningPath/raw/master/src/OperatingSystems/assets/早期批处理系统.JPG)
![Image text](https://github.com/panhongjin/AndroidLearningPath/raw/master/src/OperatingSystems/assets/早期批处理系统流程.JPG)
2. 单道批处理系统的特征<br>
&emsp;&emsp;单道批处理系统是最早出现的一种OS，严格地说，它只能算作是OS的前身而并非是现在人们所理解的OS。尽管如此，该系统比起人工操作方式的系统已有很大进步。该系统的主要特征如下：
- 自动性
- 顺序性
- 单道性


### 1.2.3 多道批处理系统

1. 多道程序设计的基本概念<br>
&emsp;&emsp;在单道批处理系统中，内存中仅有一道作业，它无法充分利用系统中的所有资源，致使系统性能较差。为了进一步提高资源的利用率和系统吞吐量，在60年代中期又引入了多道程序设计技术，由此而形成了多道批处理系统。在该系统中，用户所提交的作业都先存放在外存上并排成一个队列，称为“后备队列”；然后，由作业调度程序按一定的算法从后备队列中选择若干个作业调入内存，使它们共享CPU和系统中的各种资源。<br>
在OS中引入多道程序设计技术可带来以下好处：
- 提高CPU的利用率<br>
&emsp;&emsp;当内存中仅有一道程序时，每逢该程序在运行中发出I/O请求后，CPU空闲，必须在其I/O完成后才继续运行；尤其因I/O设备的低速性，更使CPU的利用率显著降低。图示出了单道程序的运行情况，从图可以看出：在t2~t3、 t6~t7时间间隔内CPU空闲。在引入多道程序设计技术后， 由于同时在内存中装有若干道程序，并使它们交替地运行， 这样，当正在运行的程序因I/O而暂停执行时，系统可调度另一道程序运行，从而保持了CPU处于忙碌状态。
![Image text](https://github.com/panhongjin/AndroidLearningPath/raw/master/src/OperatingSystems/assets/单道和多道程序运行情况.JPG)
- 可提高内存和I/O设备利用率<br>
&emsp;&emsp;为了能运行较大的作业，通常内存都具有较大容量，但由于80%以上的作业都属于中小型，因此在单道程序环境下，也必定造成内存的浪费。类似地，对于系统中所配置的多种类型的I/O设备， 在单道程序环境下也不能充分利用。如果允许在内存中装入多道程序， 并允许它们并发执行，则无疑会大大提高内存和I/O设备的利用率。
- 增加系统吞吐量<br>
&emsp;&emsp;在保持CPU、I/O设备不断忙碌的同时，也必然会大幅度地提高系统的吞吐量，从而降低作业加工所需的费用。
2. 多批道处理系统的特征
- 多道性
- 无序性
- 调度性
3. 多道批处理系统的优缺点：
- 资源利用率高
- 系统吞吐量大
- 平均周转时间长
- 无交互能力
4. 多道批处理系统需要解决的问题
- 处理机管理问题
- 内存管理问题
- I/O设备管理问题
- 文件管理问题
- 作业管理问题


### 1.2.4 分时系统

1. 分时系统的产生<br>
&emsp;&emsp;如果说， 推动多道批处理系统形成和发展的主要动力，是提高资源利用率和系统吞吐量，那么，推动分时系统形成和发展的主要动力，则是用户的需求。或者说，分时系统是为了满足用户需求所形成的一种新型OS。它与多道批处理系统之间，有着截然不同的性能差别。用户的需求具体表现在以下几个方面：
- 人-机交互
- 共享主机
- 便于用户上机
2. 分时系统实现中的关键问题<br>
&emsp;&emsp;为实现分时系统，其中，最关键的问题是如何使用户能与自己的作业进行交互，即当用户在自己的终端上键入命令时， 系统应能及时接收并及时处理该命令，再将结果返回给用户。 此后， 用户可继续键入下一条命令，此即人—机交互。应强调指出，即使有多个用户同时通过自己的键盘键入命令，系统也应能全部地及时接收并处理：
- 及时接收
- 及时处理<br>
![Image text](https://github.com/panhongjin/AndroidLearningPath/raw/master/src/OperatingSystems/assets/分时系统.JPG)
3. 分时系统的特征<br>
- 多路性：允许在一台主机上同时联接多台联机终端，系统按分时原则为每个用户服务。宏观上是多个用户同时工作，共享系统资源，而微观上则是每个用户作业轮流运行一个时间片。多路性即同时性，它提高了资源利用率，从而促进了计算机更广泛的应用。
- 独立性：每个用户各占一个终端，彼此独立操作，互不干扰。因此用户会感觉到就象他一人独占主机。
- 交互性：用户可通过终端与系统进行广泛的人机对话。用户可以请求系统提供多方面服务，如文件编辑，数据处理和资源共享等。
- 及时性：用户的请求能在很短时间内获得响应，此时间间隔是以人们所能接受的等待时间来确定的，通常为1-2秒。
4. 分时系统的重要指标--响应时间<br>
&emsp;&emsp;响应时间是分时系统的重要指标，它是用户发生终端命令到系统开始作出响应间的时间间隔。系统的响应时间主要是根据用户所能接受的等待时间确定的。假设分时系统中用户数为n，每个用户的运行时间片为q，则系统的响应时间为T＝n×q。每个用户分到的时间片q由二部分组成，用于对换时间S和用于真正处理时间T(处理)。
- T = n X q
- q = S + T(处理)<br>
![Image text](https://github.com/panhongjin/AndroidLearningPath/raw/master/src/OperatingSystems/assets/分时系统实现.JPG)
5. 响应时间<br>
- 分时系统中时间片q的选择是一个复杂和关键的任务，如时间片选得过大，造成响应时间不变时用户数减少，或造成响应时间过长，当时间片过小时，在一个时间片内切换开销相对增加，一个进程相对要花费更多的时间片才能运行结束，一个进程在系统中的周转时间大大增长。最佳的时间片值应既能使分时用户得到好的响应时间，同时又要使在一个时间片内切换开销相对较小可忽略。
- UNIX系统是典型的分时系统，UNIX系统是一个多用户，多任务操作系统。


### 1.2.5 实时系统

&emsp;&emsp;所谓“实时”，是表示“及时”，而实时系统(Real-Time System)是指系统能及时(或即时)响应外部事件的请求，在规定的时间内完成对该事件的处理，并控制所有实时任务协调一致地运行。 
1. 应用需求
- 实时控制
- 实时信息处理
2. 实时任务
1). 按任务执行时是否呈现周期性来划分：周期性实时任务；非周期性实时任务。
外部设备所发出的激励信号并无明显的周期性，但都必须联系着一个截止时间(Deadline)。它又可分为：
- 开始截止时间-任务在某时间以前必须开始执行；
- 完成截止时间-任务在某时间以前必须完成。
2). 根据对截止时间的要求来划分：硬实时任务(hard real-time task)，系统必须满足任务对截止时间的要求，否则可能出现难以预测的结果；软实时任务(soft real-time task)，它也联系着一个截止时间，但并不严格，若偶尔错过了任务的截止时间，对系统产生的影响也不会太大。
3. 实时系统与分时系统特征的比较：
- 多路性；
- 独立性；
- 及时性；
- 交互性；
- 可靠性；


## 1.3

### 1.3.1 并发(Concurrence)

&emsp;&emsp;并行性和并发性是既相似又有区别的两个概念，并行性是指两个或多个事件在同一时刻发生；而并发性是指两个或多个事件在同一时间间隔内发生。在多道程序环境下，并发性是指在一段时间内，宏观上有多个程序在同时运行，但在单处理机系统中，每一时刻却仅能有一道程序执行，故微观上这些程序只能是分时地交替执行。倘若在计算机系统中有多个处理机，则这些可以并发执行的程序便可被分配到多个处理机上，实现并行执行，即利用每个处理机来处理一个可并发执行的程序，这样，多个程序便可同时执行。

### 1.3.2 共享(Sharing)

&emsp;&emsp;在操作系统环境下，所谓共享是指系统中的资源可以供内存中多个并发执行的进程(线程)共同使用。由于资源属性的不同，进程对资源共享的方式也不同，目前主要一下两种资源共享方式。
1. 互斥共享方式。系统中的某些资源，如打印机、磁带机，虽然它们可以提供给多个进程(线程)使用，但为使所打印或记录的结果不至造成混淆，应规定在一段时间内只允许一个进程(线程)访问该资源。为此，当一个进程A要访问某资源时，必须先提出请求，如果此时该资源空闲，系统便可将之分配给请求进程A使用，此后若再有其它进程也要访问该资源时(只要A未用完)则必须等待。仅当A进程访问完并释放该资源后，才允许另一进程对该资源进行访问。我们把这种资源共享方式称为互斥式共享，而把在一段时间内只允许一个进程访问的资源称为临界资源或独占资源。计算机系统中的大多数物理设备，以及某些软件中所用的栈、变量和表格，都属于临界资源，它们要求被互斥地共享。
2. 同时访问方式。系统中还有另一类资源，允许在一段时间内由多个进程“同时”对它们进行访问。这里所谓的“同时”往往是宏观上的，而在微观上，这些进程可能是交替地对该资源进行访问。典型的可供多个进程“同时”访问的资源是磁盘设备，一些用重入码编写的文件，也可以被“同时”共享，即若干个用户同时访问该文件。<br>
&emsp;&emsp;并发和共享是操作系统的两个最基本的特征，它们又是互为存在的条件。一方面，资源共享是以程序(进程)的并发执行为条件的，若系统不允许程序并发执行，自然不存在资源共享问题；另一方面，若系统不能对资源共享实施有效管理，协调好诸进程对共享资源的访问，也必然影响到程序并发执行的程度，甚至根本无法并发执行。
 
### 1.3.3 虚拟机(Virtual)

&emsp;&emsp;操作系统中的所谓“虚拟”，是指通过某种技术把一个物理实体变为若干个逻辑上的对应物。物理实体(前者)是实的，即实际存在的；而后者是虚的，是用户感觉上的东西。相应地，用于实现虚拟的技术，称为虚拟技术。在OS中利用了多种虚拟技术，分别用来实现虚拟处理机、虚拟内存、虚拟外部设备和虚拟信道等。<br>
&emsp;&emsp;在虚拟处理机技术中，是通过多道程序设计技术，让多道程序并发执行的方法，来分时使用一台处理机的。此时，虽然只有一台处理机，但它能同时为多个用户服务，使每个终端用户都认为是有一个CPU在专门为他服务。亦即，利用多道程序设计技术，把一台物理上的CPU虚拟为多台逻辑上的CPU，也称为虚拟处理机，我们把用户所感觉到的CPU称为虚拟处理器。<br>
&emsp;&emsp;类似地，可以通过虚拟存储器技术，将一台机器的物理存储器变为虚拟存储器，以便从逻辑上来扩充存储器的容量。此时，虽然物理内存的容量可能不大，但它可以运行比它大得多的用户程序。这使用户所感觉到的内存容量比实际内存容量大得多。当然这时用户所感觉到的内存容量是虚的。我们把用户所感觉到的存储器称为虚拟存储器。<br>
&emsp;&emsp;我们还可以通过虚拟设备技术，将一台物理I/O设备虚拟为多台逻辑上的I/O设备，并允许每个用户占用一台逻辑上的I/O设备，这样便可使原来仅允许在一段时间内由一个用户访问的设备(即临界资源)，变为在一段时间内允许多个用户同时访问的共享设备。例如，原来的打印机属于临界资源，而通过虚拟设备技术，可以把它变为多台逻辑上的打印机，供多个用户“同时”打印。此外，也可以把一条物理信道虚拟为多条逻辑信道(虚信道)。在操作系统中，虚拟的实现主要是通过分时使用的方法。显然，如果n是某物理设备所对应的虚拟的逻辑设备数，则虚拟设备的平均速度必然是物理设备速度的1/n。

### 1.3.4 异步性(Asynchronism)

&emsp;&emsp;在多道程序环境下，允许多个进程并发执行，但只有进程在获得所需的资源后方能执行。在单处理机环境下，由于系统中只有一个处理机，因而每次只允许一个进程执行，其余进程只能等待。当正在执行的进程提出某种资源要求时，如打印请求，而此时打印机正在为其它某进程打印，由于打印机属于临界资源，因此正在执行的进程必须等待，且放弃处理机，直到打印机空闲，并再次把处理机分配给该进程时，该进程方能继续执行。可见，由于资源等因素的限制，使进程的执行通常都不是“一气呵成”，而是以“停停走走”的方式运行。<br>
&emsp;&emsp;内存中的每个进程在何时能获得处理机运行，何时又因提出某种资源请求而暂停，以及进程以怎样的速度向前推进，每道程序总共需多少时间才能完成，等等，都是不可预知的。由于各用户程序性能的不同，比如，有的侧重于计算而较少需要I/O；而又有的程序其计算少而I/O多，这样，很可能是先进入内存的作业后完成；而后进入内存的作业先完成。或者说，进程是以人们不可预知的速度向前推进，此即进程的异步性。尽管如此，但只要运行环境相同，作业经多次运行，都会获得完全相同的结果。因此，异步运行方式是允许的，是操作系统的一个重要特征。


## 1.4 操作系统的主要功能

### 1.4.1 处理机管理功能

1. 进程控制<br>
&emsp;&emsp;在传统的多道程序环境下，要使作业运行，必须先为它创建一个或几个进程，并为之分配必要的资源。当进程运行结束时，立即撤消该进程，以便能及时回收该进程所占用的各类资源。进程控制的主要功能是为作业创建进程、撤消已结束的进程。以及控制进程在运行过程中的状态转换。在现代OS中，进程控制还应具有为一个进程创建若干个线程的功能和撤消(终止)已完成任务的线程的功能。
2. 进程同步<br>
&emsp;&emsp;为使多个进程能有条不紊地运行，系统中必须设置进程同步机制。进程同步的主要任务是为多个进程(含线程)的运行进行协调。有两种协调方式：进程互斥方式，这是指诸进程(线程)在对临界资源进行访问时，应采用互斥方式；进程同步方式，指在相互合作去完成共同任务的诸进程(线程)间，由同步机构对它们的执行次序加以协调。<br>
为了实现进程同步，系统中必须设置进程同步机制。最简单的用于实现进程互斥的机制，是为每一个临界资源配置一把锁W，当锁打开时，进程(线程)可以对该临界资源进行访问；而当锁关上时，则禁止进程(线程)访问该临界资源。
3. 进程通信<br>
&emsp;&emsp;在多道程序环境下，为了加速应用程序的运行，应在系统中建立多个进程，并且再为一个进程建立若干个线程，由这些进程(线程)相互合作去完成一个共同的任务。而在这些进程(线程)之间，又往往需要交换信息。例如，有三个相互合作的进程，它们是输入进程、计算进程和打印进程。输入进程负责将所输入的数据传送给计算进程；计算进程利用输入数据进行计算，并把计算结果传送给打印进程；最后，由打印进程把计算结果打印出来。进程通信的任务就是用来实现在相互合作的进程之间的信息交换。<br>
当相互合作的进程(线程)处于统一计算机系统时，通常在它们之前是采用直接通信方式，即由源进程利用发送命令直接将消息(message)挂到目标进程的消息队列上，以后由目标进程利用接收命令从其消息队列中取出消息。
4. 调度<br>
&emsp;&emsp;在后备队列上等待的每个作业，通常都要经过调度才能执行。在传统的操作系统中，包括作业调度和进程调度两步。作业调度的基本任务，是从后备队列中按照一定的算法，选择出若干个作业，为它们分配其必需的资源(首先是分配内存)。在将它们调入内存后，便分别为它们建立进程，使它们都成为可能获得处理机的就绪进程，并按照一定的算法将它们插入到就绪队列。而进程调度的任务，则是从进程的就绪队列中选出一新进程，把处理机分配给它，并为它设置运行现场，使进程投入执行。值得提出的是，在多线程OS中，通常是把线程作为独立运行和分配处理机的基本单位，为此，须把就绪线程排成一个队列，每次调度时，是从就绪线程队列中选出一个线程，把处理机分配给它。

### 1.4.2 存储器管理功能

1. 分配内存<br>
&emsp;&emsp;OS在实现内存分配时，可采取静态和动态两种方式。在静态分配方式中，每个作业的内存空间是在作业装入时确定的；在作业装入后的整个运行期间，不允许该作业再申请新的内存空间，也不允许作业在内存中“移动”；在动态分配方式中，每个作业所要求的基本内存空间，也是在装入时确定的，但允许作业在运行过程中，继续申请新的附加内存空间，以适应程序和数据的动态增涨，也允许作业在内存中“移动”。<br>
&emsp;&emsp;为了实现内存分配，在内存分配的机制中应具有这样的结构和功能：
- 内存分配数据结构，该结构用于记录内存空间的使用情况，作为内存分配的依据；
- 内存分配功能，系统按照一定的内存分配算法，为用户程序分配内存空间；
- 内存回收功能，系统对于用户不再需要的内存，通过用户的释放请求，去完成系统的回收功能。
2. 内存保护<br>
&emsp;&emsp;内存保护的主要任务，是确保每道用户程序都只在自己的内存空间内运行，彼此互不干扰。<br>
为了确保每道程序都只在自己的内存区中运行，必须设置内存保护机制。一种比较简单的内存保护机制，是设置两个界限寄存器，分别用于存放正在执行程序的上界和下界。系统须对每条指令所要访问的地址进行检查，如果发生越界，便发出越界中断请求，以停止该程序的执行。如果这种检查完全用软件实现，则每执行一条指令，便须增加若干条指令去进行越界检查，这将显著降低程序的运行速度。因此，越界检查都由硬件实现。当然，对发生越界后的处理，还须与软件配合来完成。
3. 地址映射<br>
&emsp;&emsp;一个应用程序(源程序)经编译后，通常会形成若干个目标程序；这些目标程序再经过链接便形成了可装入程序。这些程序的地址都是从“0”开始的，程序中的其它地址都是相对于起始地址计算的；由这些地址所形成的地址范围称为“地址空间”，其中的地址称为“逻辑地址”或“相对地址”。此外，由内存中的一系列单元所限定的地址范围称为“内存空间”，其中的地址称为“物理地址”。<br>
&emsp;&emsp;在多道程序环境下，每道程序不可能都从“0”地址开始装入(内存)，这就致使地址空间内的逻辑地址和内存空间中的物理地址不相一致。使程序能正确运行，存储器管理必须提供地址映射功能，以将地址空间中的逻辑地址转换为内存空间中的与之对应的物理地址。该功能应在硬件的支持下完成。
4. 内存扩充<br>
&emsp;&emsp;存储器管理中的内存扩充任务，并非是去扩大物理内存的容量，而是借助于虚拟存储技术，从逻辑上去扩充内存容量，使用户所感觉到的内存容量比实际内存容量大得多；或者是让更多的用户程序能并发运行。这样，既满足了用户的需求，改善了系统性能，又基本上不增加硬件投资。为了能在逻辑上扩充内存，系统必须具有内存扩充机制，用于实现下述各功能：
- 请求调入功能；
- 置换功能。

### 1.4.3 设备管理功能

&emsp;&emsp;设备管理用于管理计算机系统中所有的外围设备，而设备管理的主要任务是，完成用户进程提出的I/O请求；为用户进程分配其所需的I/O设备；提供CPU和I/O设备的利用率；提供I/O速度；方便用户使用I/O设备。为实现上述任务，设备管理应具有缓冲管理、设备分配和设备处理，以及虚拟设备等功能。
1. 缓冲管理<br>
&emsp;&emsp;CPU运行的高速性和I/O低速性间的矛盾自计算机诞生时起便已存在。而随着CPU速度迅速、大幅度的提高，使得此矛盾更为突出，严重降低了CPU的利用率。如果在I/O设备和CPU之间引入缓冲，则可有效地缓和CPU和I/O设备速度不匹配的矛盾，提高CPU的利用率，进而提高系统吞吐量。因此，在现代计算机系统中，都毫无例外地在内存中设置了缓冲区，而且还可通过增加缓冲区容量的方法，来改善系统的性能。<br>
&emsp;&emsp;最常见的缓冲区机制有单缓冲机制、能实现双向同时传送数据的双缓冲机制，以及能供多个设备同时使用的公共缓冲池机制。
2. 设备分配<br>
&emsp;&emsp;设备分配的基本任务，是根据用户进程的I/O请求、系统的现有资源情况以及按照某种设备分配策略，为之分配其所需的设备。如果在I/O设备和CPU之间，还存在着设备控制器和I/O通道时，还必须为分配出去的设备分配相应的控制器和通道。<br>
&emsp;&emsp;为了实现设备分配，系统中应设置设备控制表、控制器控制表等数据结构，用于记录设备及控制器的标记符和状态。据这些表格可以了解指定设备当前是否可用，是否忙碌，以供进行设备分配时参考。在进行设备分配时，应针对不同的设备类型而采用不同的设备分配方式。对于独占设备(临界资源)的分配，还应考虑到该设备被分配出去后，系统是否安全。设备使用完后，还应立即由系统回收。
3. 设备处理<br>
&emsp;&emsp;设备处理程序又称为设备驱动程序。其基本任务是用于实现CPU和设备控制器之间的通信，即有CPU向设备控制器发出I/O命令，要求它完成指定的I/O操作；反之由CPU接受葱控制器发来的中断请求，并给予迅速的响应和相应的处理。<br>
&emsp;&emsp;处理过程是：设备处理程序首先检查I/O请求的合法性，了解设备状态是否是空闲的，了解有关的传递参数及设置设备的工作方式。然后，便向设备控制器发出I/O命令，启动I/O设备去完成指定的I/O操作。设备驱动程序还应能及时响应由控制器发来的中断请求，并根据该中断请求的类型，调用相应的中断处理程序进行处理。对于设置了通道的计算机系统，设备处理程序还应能根据用户的I/O请求，自动地构成通道程序。

### 1.4.4 文件管理功能

1. 文件存储空间的管理<br>
&emsp;&emsp;由文件系统对诸多文件及文件的存储空间，实施统一的管理。其主要任务是为每个文件分配必要的外存空间，提高外存的利用率，并能有助于提高文件系统的运行速度。<br>
&emsp;&emsp;为此，系统应设置相应的数据结构，用于记录文件存储空间的使用情况，以供分配存储空间时参考；系统还应具有对春初空间进行分配和回收的功能。为了提高存储空间的利用率，对存储空间的分配，通常采用离散分配方式，以减少外存零头，并以盘块为基本单位。盘块的大小通常为512B~8KB。
2. 目录管理<br>
&emsp;&emsp;为了使用户能方便地在外唇上找到自己所需的文件，通常由系统为每个文件建立一个目录项。目录项包括文件名、文件属性、文件在磁盘上的物理位置等。由若干个目录项又可构成一个目录文件。目录管理的主要任务，是为每个文件建立其目录项，并对众多的目录项加以有效的组织，以实现方便的按名存取。即用户只需提供文件名，即可对该文件进行存取。其次，目录管理还应能实现文件共享，这样，只需在外存上保留一份该共享文件的副本。此外，还应能提供快速的目录查询手段，以提高对文件的检索速度。
3. 文件的读/写管理和保护
- 文件的读/写管理。该功能是根据用户的请求，从外存中读取数据；或将数据写入外存。在进行文件读(写)时，系统现根据用户给出的文件名，去检索文件目录，从中获得文件在外存中的位置。然后，利用文件读(写)指针，对文件进行读(写)。一旦读(写)完成，便修改读(写)指针，为下次读(写)做好准备。由于度和谐操作不会同时进行，故可合用一个读/写指针。
- 文件保护。防止未经核准的用户存取文件；防止冒名顶替存取文件；防止以不正确的方式使用文件。

### 1.4.5 用户接口

1. 命令接口<br>
1). 联机用户接口。这是为联机用户提供的，它由一组键盘操作命令及命令解释程序所组成。当用户在终端或控制台上每键入一条命令后，系统便立即转入命令解释程序，对该命令加一解释并执行该命令。在完成指定功能后，控制又返回到终端控制台上，等待用户键入下一条命令。这样，用户可通过先后键入不通命令的方式，来实现对作业的控制，直至作业完成。
2). 脱机用户接口。该接口是为批处理作业的用户提供的，故也称为批处理用户接口。该接口由一组作业控制语言JCL组成。批处理作业的用户不能直接与自己的作业交互作用，只能委托系统代替用户对作业进行控制和干预。这里的作业控制语言JCL便是提供给批处理作业用户的、为实现所需功能而委托系统代为控制的一种语言。用户用JCL把需要对作业进行的控制和干预，事先写在作业说明书上，然后将作业连同作业说明书一起提供给系统。当系统调度到该作业运行时，又调用命令解释程序，对作业说明书的命令，逐条地解释执行。如果作业在执行过程中出现异常现象，系统也将根据作业说明书上的指示进行干预。这样，作业一直在作业说明书的控制下运行，直至遇到作业结束语句时，系统才停止该作业的运行。
2. 程序接口<br>
&emsp;&emsp;该接口是为用户程序在执行中访问系统资源而设置的，是用户程序取得操作系统服务的唯一途径。它是由一组系统调用组成，每一个系统调用都是一个能完成特定功能的子程序，每当应用程序要求OS提供某种服务(功能)时，便调用具有相应功能的系统调用。早起的系统调用都是用汇编语言提供的，只有在用汇编语言书写的程序中，才能直接使用系统调用；但在高级语言以及C语言中，往往提供了与各系统调用一一对应的库函数，这样，应用程序便可通过调用对应的库函数来使用系统调用。但在近几年所推出的操作系统中，如UNIX、OS/2版本中，其系统调用本身已经采用C语言编写，并以函数形式提供，故在用C语言编制的程序中，可直接使用系统调用。
3. 图形接口<br>
&emsp;&emsp;用户虽然可以通过联机用户接口来取得OS的服务，但这时要求用户能熟记各种命令的名字和格式，并严格按照规定的格式输入命令，这既不方便又花时间，于是，图形用户接口便应运而生。图形用户接口采用了图形化的操作界面，用非常容易识别的各种图标(icon)来将系统的各项功能、各种应用程序和文件，直观、逼真地表示出来。用户可用鼠标或通过菜单和对话框，来完成对应用程序和文件的操作。此时用户已完全不必享使用命令接口那样去记住命令名及格式，从而把用户从繁琐且单调的操作中解脱出来。









































































































































































